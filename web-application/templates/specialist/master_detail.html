{% extends 'base.html' %}
{% load staticfiles thumbnail %}
{% block content %}
    <main class="specialist">
        <div class="grid">
            <div class="personal_block">

                <div class="master">
                    <a class="master_img">
                        <span>
                            {% if master.photo %}
                                {% thumbnail master.photo "154x154" as im %}
                                    <img src="{{ im.url }}" alt={{ master.full_name }}>
                                {% endthumbnail %}
                            {% else %}
                                <img src="{% static 'img/no_photo.png' %}" alt='no image'>
                            {% endif %}
                        </span>
                    </a>
                    <div class="master_desc">
                        <h4>{{ master.full_name }}</h4>
                        <span>{{ master.get_categories }}</span>
                        <span></span>
                        <p>{{ master.short_info }}</p>
                        <ul>
                            <li>
                                <i class="fa fa-map-marker" aria-hidden="true"></i> {{ master.street_address }}
                            </li>
                            <li>
                                {% for contact in master.specialist_contacts.all %}
                                    <i class="fa fa-phone" aria-hidden="true"></i> {{ contact.phone }}
                                {% endfor %}
                            </li>
                            {% if master.sex %}
                                <li>
                                    <i class="fa fa-venus-mars" aria-hidden="true"></i> {{ master.sex }}
                                </li>
                            {% endif %}
                            <li>
                                <i class="fa fa-envelope" aria-hidden="true"></i> {{ master.user.email }}
                            </li>
                        </ul>
                    </div>

                    {% if request.user != master.user %}
                        <a href="#" id="leave_comment">ОСТАВИТЬ ОТЗЫВ</a>
                    {% endif %}
                    {% if request.user == master.user %}
                        <a href="{% url 'master_edit' master.slug %}">Редактировать</a>
                    {% endif %}
                </div>
                {% include 'specialist/reviews.html' %}
            </div>
            <div class="shedule_block">
                {% include 'messages.html' %}

                {% if master.schedule_setting_specialist.all %}
                    <div class="main-wrap">
                        <h4>Записаться к специалисту</h4>
                        {% if request.user == master.user %}
                            <div class="edit_time">
                                <a href="{% url 'update_schedule_setting' master.slug %}"><i class="fa fa-pencil" aria-hidden="true"></i>Редактировать график работы</a>
                            </div>
                        {% endif %}
                        <a href="#" onclick="prevWeek()" id="prev-week"><i class="fa fa-angle-left fa-3x"
                                                                           aria-hidden="true"></i></a>
                        <a href="#" onclick="nextWeek()" id="next-week"><i class="fa fa-angle-right fa-3x"
                                                                           aria-hidden="true"></i></a>


                        <div class="main">
                            <div class='loader'>
                                <img src="{% static 'img/loader.gif' %}" alt="">
                            </div>
                        </div>
                    </div>
                {% else %}
                    {% if request.user == master.user %}
                        <div class="set_time">
                             <a href="{% url "add_schedule_setting" master.slug %}"> <i class="fa fa-clock-o fa-2x" aria-hidden="true"></i> Указать время работы</a>
                        </div>

                    {% endif %}
                {% endif %}

                <div class="p_description">
                    <div>
                        <h4>О специалисте</h4>
                        {{ master.info|safe }}
                    </div>
                    <div>
                        <h4>Услуги</h4>
                        {% for tag in master.tags.all %}
                            <span>{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% include 'specialist/certificate_of_specialist.html' %}
        </div>
    </main>

    {% include 'specialist/specialist_review_form.html' %}

    <!-- popup for armored request -->
    <div class="modal fade" tabindex="-1" role="dialog" id="armored-modal" style="z-index: 1050">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" style="text-align: center;">
                    Запись на это время уже была оформлена до Вас, но еще не подтверждена специалистом, Вы можете подождать пока данное время освободится, либо выбрать другое.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <!-- popup for armored request -->

    <style>
        .main-wrap {
            width: 100%;
            background-color: #fff;
            padding: 35px 15px 40px 40px;
            position: relative;
        }

        .main-wrap > a {
            color: #11EBE6;
            position: absolute;
            top: 78px;
            width: 30px;
            height: 36px;
            display: flex;
            z-index: 10;
        }

        .main-wrap > a i {
            margin: auto;
        }

        #prev-week {
            left: 20px;
        }

        #next-week {
            right: 34px;
        }

        .main {
            position: relative;
            width: 100%;
            height: 406px;
            padding-right: 25px;
            overflow-y: scroll;
            display: flex;
            justify-content: space-between;
        }

        .weekday {
{#            padding: 0 10px;#}
            text-align: center;
            width: 98px;
        }

        .weekday > span {
            display: block;
            padding-bottom: 10px;
            color: #95989A;
            font-size: 14px;
        }

        .weekday > span:last-of-type {
            display: block;
            padding-bottom: 15px;
        }

        .time {
            background-color: #11EBE6;
            padding: 8px 0;
            margin-bottom: 10px;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 5px;
            font-size: 14px;
            color: #ffffff;
            position: relative;
            box-sizing: border-box;
            cursor: pointer;
        }
        
        .time:hover:not(.taken) {
            background-color: #04c1bd;
        }

        .time .phone {
            position: absolute;
            bottom: -30px;
            left: 0;
            font-size: 14px;
            color: #000;
            padding: 5px 10px;
            background: #fff;
            z-index: 3;
            box-shadow: 0px 0px 5px 5px rgba(0,0,0,0.1);
        }
        
        

        .taken {
            background: #cccccc;
        }

        .order-modal-wrap {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .order-modal {
            display: block;
            width: 390px;
            height: 390px;
            background: #fff;
            padding: 30px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            box-shadow: 0 0 20px 3px rgba(0,0,0,0.15);
        }

        .close_modal {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            color: #04c1bd;
            font-size: 16px;
        }

        .inputs {
            padding-top: 40px;
            text-align: center
        }
        .inputs input {
            display: block;
            width: 100%;
            padding: 10px 20px;
            margin-bottom: 20px;
            outline: none;
            text-align: left;
            border: 1px solid #dcdcdc;
            border-radius: 4px;
            font-size: 12px;
            color: #222222;
{#					&:hover,#}
{#					&:focus#}
{#						border-color: #8be0de#}
        }
        .inputs input.error {
            border-color: red;
        }
        .inputs button {
            display: inline-block;
            padding: 10px 30px;
            color: #fff;
            border:  0;

            font-size: 12px;
            border-radius: 6px;
            background-color: #17FFFA;
            width: 190px;
            height: 40px;
            margin-top: 20px;
            cursor: pointer;
            outline: 0;
        }
        .order-modal .title {
            font-size: 16px;
			color: #222222;
			text-align: center;
			text-transform: uppercase;
			padding-bottom: 20px;
        }

        .order-modal .title-time {
            text-align: center;
            padding: 5px 0;
            font-size:  12px;
        }

        .error, .success {
            width: 100%;
            text-align: center;
            line-height: 18px;
            padding: 10px 0;
        }
        .success {
            display: none;
            color: rgb(94, 196, 94);
        }
        .error {
            display: none;
            color: rgb(254, 62, 62);
        }

        .authorization-text a {
            color: #17FFFA;
        }

        .loader {
            padding: 70px 0;
            width: 100px;
        }
        .loader img {
            width: 100px;
            height: 100px;
        }

    </style>

{% endblock %}
{% block js %}
    <script>

        // GLOBAL VARIABLES
        var toOrder = {
            day: '',
            time: ''
        };
        var work = {
            workingDays: [],
            lunch: '',
            timeInterval: ''
        };
        var weekStep = 6;
        var limitDate = new Date();
        limitDate.setDate(limitDate.getDate() + 30);
        var weekDay = {
            start: new Date().setHours(0,0,0,0),
            end: '',
            limit: limitDate
        };
        var takenArr = [];
        var weekDays = ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'];
        var mainArray = [];

        // LISTENERS
        document.querySelector(".order-modal-wrap").addEventListener('click', function(event){
            if (event.target.classList.contains('order-modal-wrap')) {
                toggleModal(false);
            }
        });
        function addListenerToTime(){
            document.querySelector('body').addEventListener('click', function(event) {
                {% if request.user != master.user %}
                if (event.target.classList.contains("time") && !event.target.classList.contains("taken") && !event.target.classList.contains("armored")) {
                    toOrder.time = event.target.innerHTML;
                    toOrder.day = event.target.parentElement.dataset.date;
                    toggleModal(true);
                }
                if (event.target.classList.contains("armored")) {
                    $("#armored-modal").modal();
                }
                {% endif %}
                {% if request.user == master.user %}
                if (event.target.parentElement.classList.contains("time") &&
                    event.target.parentElement.classList.contains("taken") &&
                    !event.target.parentElement.classList.contains("no-phone")
                ) {
                    if (event.target.parentElement.querySelector(".phone").style.display == "block") {
                        event.target.parentElement.querySelector(".phone").style.display = "none";
                    } else {
                        event.target.parentElement.querySelector(".phone").style.display = "block";
                    }
                }
                if (event.target.classList.contains("time") && !event.target.classList.contains("taken") && !event.target.classList.contains("armored") || 
                    event.target.parentElement.classList.contains("time") && !event.target.parentElement.classList.contains("taken") && !event.target.parentElement.classList.contains("armored")) {
                    toOrder.time = event.target.innerHTML;
                    toOrder.day = event.target.parentElement.dataset.date || event.target.parentElement.parentElement.dataset.date;
                    toOrder.status = 'confirmed';
                    toggleModal(true);
                }
                {% endif %}
            });
        }

        // UI
        function toggleModal(state) {
            if (state == true) {
                document.querySelector(".blur").style.filter = "blur(5px)";
                document.querySelector(".order-modal-wrap").style.display = 'block';
                document.querySelector(".title-time").innerHTML = "Запись на " + new Date(toOrder.day).getFullYear() + '-' + (new Date(toOrder.day).getMonth()+1) + '-' + new Date(toOrder.day).getDate() + ' ' + toOrder.time;
            } else if (state == false) {
                document.querySelector(".order-modal-wrap").style.display = 'none';
                document.querySelector(".blur").style.filter = "blur(0px)";
                document.querySelector(".title-time").innerHTML = "";
            }
        }
        function betweenDate(startDt, endDt) {
            mainArray = [];
            var currentDate = new Date(startDt),
                end = new Date(endDt);
            var lunchTime = {
                start: {
                    hours: parseInt(work.lunch.split('-')[0].split(":")[0]),
                    minutes: parseInt(work.lunch.split('-')[0].split(":")[1])
                },
                end: {
                    hours: parseInt(work.lunch.split('-')[1].split(":")[0]),
                    minutes: parseInt(work.lunch.split('-')[1].split(":")[1] - 1)
                }
            };
            while (currentDate <= end) {
                var workingDay = work.workingDays.filter(x => {
                    return x.day === currentDate.getDay()
                })[0];
                if (workingDay.time) {
                    var workTime = {
                        startTime: {
                            hours: parseInt(workingDay.time.split('-')[0].split(":")[0]),
                            minutes: parseInt(workingDay.time.split('-')[0].split(":")[1])
                        },
                        endTime: {
                            hours: parseInt(workingDay.time.split('-')[1].split(":")[0]),
                            minutes: parseInt(workingDay.time.split('-')[1].split(":")[1])
                        }
                    };
                    var startTime = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate(), workTime.startTime.hours, workTime.startTime.minutes, 0);
                    var endTime = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate(), workTime.endTime.hours, workTime.endTime.minutes, 0);

                    var timeInterval = {};
                    if (work.timeInterval.indexOf(":") === -1) {
                        timeInterval = {
                            minutes: parseInt(work.timeInterval),
                            hours: 0
                        };
                    } else {
                        timeInterval = {
                            minutes: parseInt(work.timeInterval.split(':')[1]),
                            hours: parseInt(work.timeInterval.split(':')[0])
                        };
                    }

                    var time = [];
                    var lunchState = false;
                    while (new Date(startTime).getTime() <= new Date(endTime).getTime()) {
                        var lunch = {
                            start: new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate(), lunchTime.start.hours, lunchTime.start.minutes, 0),
                            end: new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate(), lunchTime.end.hours, lunchTime.end.minutes, 0)
                        };
                        var myTime = getTime(startTime);
                        // check time on lunch
                        if (new Date(startTime) >= lunch.start && new Date(startTime) <= lunch.end) {
                            if (!lunchState) {
                                myTime.taken = true;
                                myTime.time = 'Обед';
                                myTime.lunch = true;
                                lunchState = true;
                                myTime.noPhone = true;
                            } else {
                                myTime.taken = true;
                                myTime.time = null;
                            }
                        }
                        // check if now time is bigger than in block
                        if (new Date().setHours(0,0,0,0) === new Date(startTime).setHours(0,0,0,0)) {
                            var nowHours = parseInt(new Date().getHours());
                            var nowMinutes = parseInt(new Date().getMinutes());
                            var compareHours = parseInt(new Date(startTime).getHours());
                            var compareMinutes = parseInt(new Date(startTime).getMinutes());
                            if (nowHours > compareHours) {
                                myTime.taken = true;
                                myTime.noPhone = true;
                            } else if (nowHours === compareHours && nowMinutes > compareMinutes) {
                                myTime.taken = true;
                                myTime.noPhone = true;
                            }
                        }
                        takenArr.forEach(taken => {
                            if (currentDate.getDate() === new Date(taken.date).getDate()) {
                                taken.time.forEach(takenTime => {
                                    if (myTime.time === takenTime) {
                                        myTime.status = taken.status;
                                        if (taken.status == 'confirmed') {
                                            myTime.taken = true;
                                        } else {
                                            myTime.taken = false;
                                        }
                                        {% if request.user == master.user %}
                                            myTime.name = taken.name || '';
                                            myTime.phone = taken.phone || '';
                                        {% endif %}
                                    }
                                })
                            }
                        });
                        if (new Date(startTime).getTime() === new Date(endTime).getTime()) {
                            myTime.taken = true;
                            myTime.noPhone = true;
                        }
                        if (myTime.time) time.push(myTime);
                        startTime.setHours(startTime.getHours() + timeInterval.hours);
                        startTime.setMinutes(startTime.getMinutes() + timeInterval.minutes);
                    }
                    var dateObj = {
                        date: new Date(currentDate),
                        time: time
                    };
                    mainArray.push(dateObj);
                } else {
                    mainArray.push({
                        date: new Date(currentDate),
                        time: [{
                            time: 'Выходной',
                            taken: true,
                            rest: true,
                            noPhone: true
                        }]
                    })
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            console.log(mainArray);
            renderDate();
        }
        function getTime(date) {
            date = new Date(date);
            return {
                time: '' + (date.getHours() < 10 ? '0' : '') + date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes(),
                taken: false
            }
        }
        function renderDate() {
            var template = '';
            var dates = '';
            mainArray.forEach(dateObj => {
                var timeTemplate = '';
                dateObj.time.forEach(time => {
                    {% if request.user == master.user %}
                    timeTemplate += `
                            <div class="time 
                                    ${time.taken ? 'taken' : ''} 
                                    ${time.lunch ? 'lunch' : ''}
                                    ${time.status == 'armored' ? 'armored' : '' }
                                    ${time.noPhone ? 'no-phone' : ''}"
                                    ${((time.status == 'armored' || time.status == 'confirmed') && !time.noPhone) ? 'data-toggle="tooltip" data-placement="top" title="'+ time.phone +'"' : ''}>

                                <div>${time.lunch ? 'Обед' : time.time}</div>
                                <div>${time.name ? '(' + time.name + ')' : '' }</div>
                                <div class="phone" style="display: none;">${time.phone ? time.phone : '' }</div>

                            </div>
                        `;
                    {% endif %}
                    {% if request.user != master.user %}
                    timeTemplate += `
                            <div class="time 
                            ${time.status == 'armored' ? 'armored' : ''} 
                            ${(time.status == 'confirmed' || time.taken) ? 'taken' : ''}
                            ${time.lunch ? 'lunch' : ''}">
                                ${time.rest ? 'Выходной' : time.lunch ? 'Обед' : time.taken ? '---' : time.time}
                            </div>
                        `;

                    {% endif %}
                });

                var beautyDate = '' + new Date(dateObj.date).getDate() + '/' + (new Date(dateObj.date).getMonth()+1) + '/' + new Date(dateObj.date).getFullYear();
                template += `
                <div class="weekday">
                    <span>${weekDays[new Date(dateObj.date).getDay()]}</span>
                    <span>${beautyDate}</span>
                    <div class="time-block" data-date="${dateObj.date}">
                       ${timeTemplate}
                    </div>
                </div>
            `;
            });
            document.querySelector(".main").innerHTML = template;
        }
        function nextWeek() {
            var nextStart = new Date(weekDay.start);
            nextStart.setDate(nextStart.getDate() + weekStep);
            var nextEnd = new Date(weekDay.end);
            nextEnd.setDate(nextEnd.getDate() + weekStep);

            if (nextEnd >= weekDay.limit) {
                nextEnd = new Date(weekDay.limit);
                nextStart = new Date(weekDay.limit);
                nextStart.setDate(nextStart.getDate() - weekStep);
            }
            weekDay.start = nextStart;
            weekDay.end = nextEnd;
            betweenDate(nextStart, nextEnd);
        }
        function prevWeek() {
            var prevStart = new Date(weekDay.start);
            prevStart.setDate(prevStart.getDate() - weekStep);
            var prevEnd = new Date(weekDay.end);
            prevEnd.setDate(prevEnd.getDate() - weekStep);

            if (prevStart <= new Date().setHours(0,0,0,0)) {
                prevStart = new Date();
                prevStart.setHours(0,0,0,0);
                prevEnd = new Date();
                prevEnd.setHours(0,0,0,0);
                prevEnd.setDate(prevEnd.getDate() + weekStep);
            }
            weekDay.start = prevStart;
            weekDay.end = prevEnd;
            betweenDate(prevStart, prevEnd);
        }

        // REQUESTS
        function makeRequest(method, url, slug) {
            return new Promise((resolve, reject) => {
                if (method === 'GET') {
                    var xhr = new XMLHttpRequest();
                    xhr.open(method, url + slug, true);
                    xhr.onload = function (e) {
                        if (xhr.readyState === 4 && (xhr.status === 200)) {
                            resolve(JSON.parse(xhr.responseText))
                        } else {
                            reject(new Error(xhr.status, ' ', xhr.statusText))
                        }
                    };
                    xhr.onerror = function (e) {
                        reject(new Error(xhr.status, ' ', xhr.statusText))
                    };
                    xhr.send();
                }
                if (method === 'POST') {
                    var time = "" + new Date(toOrder.day).getFullYear() + 
                        '-' + (new Date(toOrder.day).getMonth()+1 > 9 ? new Date(toOrder.day).getMonth()+1 : '0' + (new Date(toOrder.day).getMonth()+1)) + 
                        '-' + (new Date(toOrder.day).getDate() > 9 ? new Date(toOrder.day).getDate() : ('0'+ new Date(toOrder.day).getDate())) + 
                        ' ' + toOrder.time.trim();
                    
                    var data = JSON.stringify({
                        "full_name": document.querySelector("#full_name").value,
                        "date_time_reservation": time,
                        "phone": document.querySelector("#phone").value
                    });
                    {% if request.user == master.user %}
                    data = JSON.stringify({
                        "full_name": document.querySelector("#full_name").value,
                        "date_time_reservation": time,
                        "phone": document.querySelector("#phone").value,
                        "status": toOrder.status,
                    });
                    {% endif %}
                    var xhr = new XMLHttpRequest();

                    xhr.addEventListener("readystatechange", function () {
                        if (this.readyState === 4) {
                            var response = JSON.parse(this.responseText);
                            if ((this.status === 200 || this.status === 201) && !response.message) {
                                resolve(response)
                            } else {
                                reject(response)
                            }
                        }
                    });
                    xhr.open("POST", url + slug + '/');
                    xhr.setRequestHeader("content-type", "application/json");
                    xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}");
                    xhr.send(data);
                }
            });
        }
        // request for getting work data
        makeRequest('GET', '/api/schedule-setting/', '{{master.slug}}').then(response => {
            Object.keys(response).forEach(key => {
                switch (key) {
                    case 'monday':
                        work.workingDays.push({day: 1, time: response[key]});
                        break;
                    case 'tuesday':
                        work.workingDays.push({day: 2, time: response[key]});
                        break;
                    case 'wednesday':
                        work.workingDays.push({day: 3, time: response[key]});
                        break;
                    case 'thursday':
                        work.workingDays.push({day: 4, time: response[key]});
                        break;
                    case 'friday':
                        work.workingDays.push({day: 5, time: response[key]});
                        break;
                    case 'saturday':
                        work.workingDays.push({day: 6, time: response[key]});
                        break;
                    case 'sunday':
                        work.workingDays.push({day: 0, time: response[key]});
                        break;
                    default:
                        break;
                }
            });
            work.lunch = response.lunch;
            work.timeInterval = response.time_interval.time_interval;

            makeRequest('GET', '/api/reservation/', '{{master.slug}}').then(response => {
                if (response && response.results) {
                    console.log(response.results);
                    if (response.results.length > 0) {
                        response.results.forEach(item => {
                            var date = item.date_time_reservation.split(" ")[0];
                            date = date.split('.');
                            date = new Date('' + date[2] + '/' + (parseInt(date[1])+1) + '/' + date[0]);
                            var time = item.date_time_reservation.split(" ")[1];
                            {% if request.user == master.user %}
                            if (item.status !== 'refused') {
                                takenArr.push({date: date, time: [time], name: item.full_name, phone: item.phone, status: item.status});
                            }
                            {% endif %}
                            {% if request.user != master.user %}
                            if (item.status !== 'refused') {
                                takenArr.push({date: date, time: [time], status: item.status});
                            }
                            {% endif %}
                        });
                    }
                }
                var nextDate = new Date();
                nextDate.setHours(0, 0, 0, 0);
                nextDate.setDate(nextDate.getDate() + weekStep);
                weekDay.end = nextDate;
                betweenDate(new Date().setHours(0, 0, 0, 0), nextDate);
                addListenerToTime();
            });
        });
        // POST Request to make order
        document.querySelector("#make-order").addEventListener('click', function(){
            if (!document.querySelector("#phone").value) {
                document.querySelector(".error").innerHTML += '<div> Поле телефон не введено </div>';
                document.querySelector(".error").style.display = "block";
                input = document.querySelector("#phone");
                input.classList.add('error');
                setTimeout(function(){
                    input.classList.remove('error');
                    document.querySelector(".error").innerHTML = "";
                    document.querySelector(".error").style.display = "";
                }, 3000);
                return;
            }
            makeRequest('POST', '/api/reservation/add/', '{{master.slug}}').then(response => {
                document.querySelector(".success").style.display = "block";
                document.querySelector(".success").innerHTML = "Заявка успешно оформлена, ожидайте подтверждение специалиста";
                setTimeout(function(){
                    document.querySelector(".success").innerHTML = "";
                    document.querySelector(".success").style.display = "";
                    document.querySelector(".error").innerHTML = "";
                    toggleModal(false);
                }, 3000);
            }).catch(response => {
                var input = '';
                document.querySelector(".error").style.display = "block";
                if (Object.keys(response).indexOf('message') === -1) {
                    Object.keys(response).forEach(key => {
                        document.querySelector(".error").innerHTML += '<div>' + response[key] + '</div>';
                        input = document.querySelector("#"+key);
                        input.classList.add('error');
                    });
                    setTimeout(function(){
                        input.classList.remove('error');
                        document.querySelector(".error").innerHTML = "";
                        document.querySelector(".error").style.display = "";
                    }, 3000);
                } else {
                    document.querySelector(".error").innerHTML += '<div>' + response.message + '</div>';
                    document.querySelector(".error").insertAdjacentHTML('afterend', '<div class="authorization-text" style="text-align: center"><a href="/accounts/login">Авторизация</a></div>')
                }
            })
        });

    </script>
{% endblock %}